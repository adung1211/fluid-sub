<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subtitle Settings</title>
    <style>
      body {
        width: 280px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        padding: 16px;
        background: #202020;
        color: #e0e0e0;
        user-select: none;
        min-height: 200px; /* Ensure height for loader */
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #444;
        padding-bottom: 12px;
        margin-bottom: 16px;
      }
      h2 { margin: 0; font-size: 16px; font-weight: 600; }
      h3 { font-size: 13px; color: #aaa; margin: 20px 0 8px 0; text-transform: uppercase; letter-spacing: 0.5px; }

      /* Toggle Switch */
      .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
      .switch input { opacity: 0; width: 0; height: 0; }
      .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 34px; }
      .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
      input:checked + .slider { background-color: #4CAF50; }
      input:checked + .slider:before { transform: translateX(20px); }

      /* Views */
      .view-section { display: none; }
      .view-section.active { display: block; }

      /* Loading Animation */
      .loader-container {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 40px 0; text-align: center;
      }
      .spinner {
        border: 4px solid #333; border-top: 4px solid #4CAF50; border-radius: 50%;
        width: 30px; height: 30px; animation: spin 1s linear infinite; margin-bottom: 12px;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .loader-text { font-size: 13px; color: #aaa; }

      /* Error/Empty State */
      .error-container {
        text-align: center; padding: 30px 10px; background: #2a2a2a; border-radius: 8px; margin-top: 10px;
      }
      .error-icon { font-size: 24px; margin-bottom: 8px; display: block; }
      .error-text { font-size: 13px; color: #e0e0e0; }
      .error-sub { font-size: 11px; color: #888; margin-top: 4px; }

      /* Main Controls */
      .control { margin-bottom: 16px; }
      label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; color: #aaa; }
      input[type="range"] { width: 100%; accent-color: #4CAF50; cursor: pointer; height: 4px; background: #444; border-radius: 2px; appearance: none; }
      .value { color: #fff; font-weight: bold; }

      /* Highlight Rows */
      .highlight-list { display: flex; flex-direction: column; gap: 8px; }
      .highlight-row { display: flex; align-items: center; justify-content: space-between; background: #2a2a2a; padding: 6px 10px; border-radius: 6px; }
      .highlight-info { display: flex; align-items: center; gap: 10px; flex: 1; }
      .highlight-label { font-size: 13px; font-weight: 600; width: 45px; } 
      .highlight-desc { font-size: 11px; color: #888; }
      
      input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; padding: 0; }
      input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
      input[type="color"]::-webkit-color-swatch { border: 1px solid #555; border-radius: 4px; }
      .cb-wrapper { display: flex; align-items: center; }
      .cb-wrapper input { margin: 0; width: 16px; height: 16px; accent-color: #4CAF50; cursor: pointer; }

      .primary-btn {
        width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 4px;
        cursor: pointer; font-weight: 600; font-size: 14px; margin-top: 20px; transition: background 0.2s;
        display: flex; justify-content: center; align-items: center; gap: 8px;
      }
      .primary-btn:hover { background: #43a047; }

      .danger-btn { margin-top: 12px; width: 100%; padding: 8px; background: transparent; color: #cf4646; border: 1px solid #cf4646; border-radius: 4px; cursor: pointer; font-size: 11px; transition: background 0.2s; }
      .danger-btn:hover { background: rgba(207, 70, 70, 0.1); }
    </style>
  </head>
  <body>
    <!-- Always Visible Header -->
    <header>
      <h2>Enable Captions</h2>
      <label class="switch">
        <input type="checkbox" id="enabled">
        <span class="slider"></span>
      </label>
    </header>

    <!-- 1. Loading View -->
    <div id="loading-view" class="view-section">
      <div class="loader-container">
        <div class="spinner"></div>
        <div class="loader-text">Analyzing Vocabulary...</div>
      </div>
    </div>

    <!-- 2. Error/Not Found View -->
    <div id="error-view" class="view-section">
      <div class="error-container">
        <span class="error-icon">üö´</span>
        <div class="error-text">No Captions Found</div>
        <div class="error-sub">This video might not have English subtitles or they are restricted.</div>
      </div>
    </div>

    <!-- 3. Main Controls View -->
    <div id="main-view" class="view-section">
      <div class="control">
        <label>Font Size: <span id="val-size" class="value">24px</span></label>
        <input type="range" id="fontSize" min="12" max="60" step="1">
      </div>

      <div class="control">
        <label>Background Opacity: <span id="val-bg" class="value">0.6</span></label>
        <input type="range" id="bgOpacity" min="0" max="1" step="0.1">
      </div>

      <div class="control">
        <label>Text Opacity: <span id="val-text" class="value">1.0</span></label>
        <input type="range" id="textOpacity" min="0.1" max="1" step="0.1">
      </div>

      <h3>Vocabulary Highlights</h3>
      <div class="highlight-list" id="highlight-list">
        <!-- Generated by JS -->
      </div>
      
      <button id="save-reload" class="primary-btn">
        <span>üíæ Save & Reload Page</span>
      </button>
    </div>

    <button id="clear-cache" class="danger-btn">‚ö†Ô∏è Clear Cache (Debug)</button>

    <script type="module" src="./index.ts"></script>
  </body>
</html>